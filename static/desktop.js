(function(p){function g(a,e){this.model=e;document.createDocumentFragment();this.overlay=document.createElement("div");this.container=document.createElement("div");this.controls=document.createElement("div");this.overlay.id="overlay";this.container.id="container";this.controls.id="controls";this.transitioning=!1;a.appendChild(this.overlay);a.appendChild(this.container);a.appendChild(this.controls);t(this,e,this.controls);u(this,this.container);var c=this.overlay;c.appendChild(document.createElement("div"));
c.firstChild.className="content";h(this.container,this)}function v(a){return 1===a.length?"0"+a:a}function t(a,e,c){e.getLoggedIn(function(a){a&&$(c).addClass("loggedIn")});$(c).load("templates/desktop/controls.htm",function(){$("#navigation .left",this).click(function(){a.model.prevMonth();a.updateDisplay()});$("#navigation .right",this).click(function(){a.model.nextMonth();a.updateDisplay()})})}function u(a,e){$(e).bind("mousewheel",function(c){a.transitioning||(c=c.originalEvent,0<c.wheelDelta?
(a.model.prevMonth(),a.updateDisplay()):0>c.wheelDelta&&(a.model.nextMonth(),a.updateDisplay()))})}function h(a,e){var c=document.createDocumentFragment(),l=$("<table />",{id:"month"}),q=$("<div />",{id:"name"}),m=$("<div />",{id:"year"}),g=$(a),k=$("<tr />"),f=e.model.getDate();w.forEach(function(a){k.append($("<th />").text(a.toLowerCase()))});l.append(k);$(c).append([l,q,m]);q.text(x[f.getMonth()].toLowerCase());m.text(f.getFullYear());var b=new Date(f);b.setDate(1);b.setDate(1-b.getDay());m=new Date(f.getFullYear(),
f.getMonth()+1,0);b=new Date(b);b.setHours(0);b.setMinutes(0);b.setSeconds(0);for(b.setMilliseconds(0);b<m||0!==b.getDay();){0===b.getDay()&&(k=$("<tr />"),l.append(k));var n=$("<td />");n.text(v(b.getDate().toString()));k.append(n);b.getMonth()!==f.getMonth()?n.addClass("sideMonth"):b.toDateString()===(new Date).toDateString()&&n.addClass("today");b.setDate(b.getDate()+1)}$(window).off("resize.month");g.empty().append(c);var r=$(l),d=$(q),h=d.css("font-size").replace("px",""),s=function(){var a=
d.css("font-size").replace("px","");if(d.width()>r.width()-60){var b=d.width()/(r.width()-60),c=d.width()/r.width();d.css("font-size",a/b+"px");d.css("bottom",c*g.height()*d.css("bottom").replace("%","")/100+"px")}else h>a&&(d.css("font-size",h+"px"),s())},p=setInterval(s,10);setTimeout(function(){clearInterval(p)},200);$(window).on("resize.month",s)}g.prototype.updateDisplay=function(){var a=this;this.transitioning=!0;$(this.container).fadeOut(300,function(){h(a.container,a);$(this).fadeIn(300);
setTimeout(function(){a.transitioning=!1},150)})};p.DesktopUI=g;var x="January February March April May June July August September October November December".split(" "),w="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")})(window);
